pipeline{
    agent any
    
    stages{
        stage("Code checkout"){
            steps{
                git branch: 'main', url: 'https://github.com/haqhuu/dev.git'
            }
        }
        
        stage("image build"){
            steps{
                sh "docker image build -t haquochuu/todoapp:v$BUILD_ID ."
                sh "docker image tag  haquochuu/todoapp:v$BUILD_ID  haquochuu/todoapp:latest"
            }
        }
        
        stage("Image push"){
            steps{
                withCredentials([usernamePassword(credentialsId: 'dockerhub', passwordVariable: 'pass', usernameVariable: 'user')]) {
                    sh "docker login -u ${user} -p ${pass}"
                    sh "docker image push haquochuu/todoapp:v$BUILD_ID"
                    sh "docker image push haquochuu/todoapp:latest"
                    sh "docker rmi -f haquochuu/todoapp:v$BUILD_ID haquochuu/todoapp:latest"
}
            }
        }
    }
}

    "start": "REACT_APP_API_URL=http://127.0.0.1:3000 PORT=4200 react-scripts start",
    "start": "node --env-file='.env' server",
